---
title: "NFL Passing"
author: "Damien Ruparal Nathan Tatko Sean Dube"
date: "11/17/2020"
output:
  rmdformats::readthedown:
    thumbnails: false
    highlight: NULL
    runtime: shiny
---
<center>

![ESPN - Damien Ruparel, Nathan Tatko, Sean Dube](https://raw.githubusercontent.com/stat231-f20/Blog-ESPN/main/images/team_image.jpeg)

</center>

## Our Mission

The ESPN PUG group wants to explore the outcomes of passing plays in the NFL 2018 season. Outcomes of plays include touchdown, incomplete pass,  interception, out of bounds, etc. Our dataset gave information on the ball's location at a specific point in the play, the absolute yard line (line of scrimmage), yards to go, down, and direction of play. We used this data visualize where the ball was started at the beginning of the play and where and what happened at the end of the play. 

## The Data

We gathered data from the NFL Big Bowl Data competition's dataset in Kaggle. The annual sports analytics contest from NFL Football Operations challenges talented members of the analytics community – from college students to professionals – to contribute to the NFL’s continuing evolution in the use of advanced analytics. As the NFL captures real-time data for every player, on every play, in every situation — anywhere on the field — the Big Data Bowl is the league’s next step in engaging the analytics community (NFL Ops). The data collected includes various datasets: one dataset for plays in a game, and seventeen weeks of tracking data. 

## What is so important about passing in the NFL?

Passing plays have become more common as teams can gain more yards compared to running plays. In 2018, all but one team had a passing play percentage above 50% (teamrankings.com). There were 1371 touchdowns scored and Quarterbacks threw more touchdown passes than ever before. Many people refer to the NFL as a passing league. As quarterbacks and wide receivers become more skilled we will continue to see an increase in the number of passing plays. 

## The App

To explore the outcome of passing plays, we created an app where one can input down, yards to go (short, medium, long), absolute yard line, and direction of the play. By changing these inputs, one will be able to see the outcome of every which is displayed on a choropleth of a football field. Events of the game are marked with different symbols. The app also includes a data table of the passing stats for each team in the NFL. The data table shows the count of completed passes (C), incomplete passes (I), and interceptions (IN), and the total yards gained throughout the season. Check it out! 

```{r, echo=FALSE, include=FALSE}
library(shiny)
library(ggplot2)
library(tidyverse)
library(png)
library(grid)
library(maps)
library(leaflet)
```


```{r, echo=FALSE, message = FALSE, warning=FALSE}

#plays <- read_csv("/Users/damienruparel/git/BLOG-ESPN/nfl-big-data-bowl-2021/plays.csv")


plot3 <- read.csv("Teamstats.csv")
plot4 <- read.csv("teamstatsmap.csv")
Teamstats2 <- read.csv("Teamstats2.csv")
footballfield <- png::readPNG("footballfield.png")
PassingStats <- read.csv("PassStats.csv")  



Team <-  c("ARI", "NYJ", "OAK", "SF", "JAX", "NYG", "TB", "BUF", "CIN", "DEN", "DET", "GB", "ATL", "CAR", "CLE", "MIA", "WAS", "MIN", "PHI",
           "PIT", "TEN", "BAL", "DAL", "IND", "SEA", "HOU", "NE", "CHI", "KC", "LAC", "LA", "NO")
SeasonStats <- c("W", "L", "T", "AverageYards", "CompletionRate")
ui <- fluidPage(
  
  titlePanel("NFL Passing"),
  
  mainPanel(
    selectInput(inputId = "Team", label = "NFL Teams:", choices = Team), 
    selectInput(inputId = "SeasonStats", label = "Choose a Season Statistic:", choices = SeasonStats),
    tabsetPanel(
    
      tabPanel("Averages vs. New England Patriots", plotOutput("Plot2")
      ),
      tabPanel("Season Statistics By Team", DT::dataTableOutput("Table")
      ),
      tabPanel("Total Passing Yards vs. New England Patriots", plotOutput("Plot3")
               ),
      tabPanel("Passsing Statistics By Team", DT::dataTableOutput("Table2"))
    )
  )
  
)



server <- function(input, output) {

  use_data3 <- reactive({
    data <- plot3 %>%
      filter(Team == input$Team | Team == "NE")
  })
  use_data4 <- reactive({
    data <- PassingStats %>%
      filter(Team == input$Team | Team == "NE")
  })
  
 
  output$Plot2 <- renderPlot(
    ggplot(data = use_data3(), aes_string(x = "Team", y = input$SeasonStats, fill = "Team")) + 
             geom_bar(position = "dodge", stat = "identity")
  )
  output$Plot3 <- renderPlot(
    ggplot(data = use_data4(), aes_string(x = "Team", y = "TotalYards", fill = "Team")) + 
      geom_bar(position = "dodge", stat = "identity"),
  )
  output$Table2 <- DT::renderDataTable(
    DT::datatable(PassingStats)
  )
  output$Table <- DT::renderDataTable(
    DT::datatable(plot3)
  )
 
}

  






shinyApp(ui = ui, server = server)




```









```{r, echo=FALSE, message = FALSE, warning=FALSE}
plot1 <- read.csv("plot1finished.csv")
plot2 <- read.csv("plot2finished.csv") 

togo <- c("short", "medium", "long")
direction1 <- c("left", "right")

ui <- fluidPage(
  
  titlePanel("Play by Play Passing Stats"),
  
  sidebarPanel(
    sliderInput(inputId = "down1", label = "Down",
                min = 1, max = 4,
                value = 1),
    selectInput(inputId = "ToGo", label = "Yards To Go", choices = togo),
    sliderInput(inputId = "yardline", label = "Absolute Yardline",
                min = 0, max = 110,
                value = 0),
    selectInput(inputId = "direction", label = "Direction of Play", choices = direction1),
    
  ),
  mainPanel(
 
      tabPanel("Plot of Passing Play Outcomes", plotOutput("Plot")
      ),
      tabPanel("Table of Passing Play Outcomes",  DT::dataTableOutput("Table_plot")
      )
)
)



server <- function(input, output) {
  use_data <- reactive({
    data <- plot1 %>%
      filter(down == input$down1)%>%
      filter(togo == input$ToGo) %>%
      filter(absoluteYardlineNumber == input$yardline)%>%
      filter(playDirection == input$direction)
  })
  
  use_data2 <- reactive({
    data <- plot2 %>%
      filter(down == input$down1)%>%
      filter(togo == input$ToGo) %>%
      filter(absoluteYardlineNumber == input$yardline)%>%
      filter(playDirection == input$direction)
  })
  output$Plot <- renderPlot(
    ggplot(data = use_data(), aes_string(x = "x", y = "y", shape = "event", color = "event"))+
      annotation_custom(rasterGrob(footballfield, 
                                   width = unit(1,"npc"), 
                                   height = unit(1,"npc")), 
                        -Inf, Inf, -Inf, Inf) + 
      geom_point(size = 5)+
      xlim(0,120)+
      ylim(-5,60)+
      scale_color_manual(values=c('orange','yellow', 'red', 'blue'))+
      scale_shape_manual(values=c(15, 16, 17, 18))
    
  )
  
  
  output$Table_plot <- DT::renderDataTable(
    DT::datatable(use_data2())
  )   
}

  






shinyApp(ui = ui, server = server)




```




## Our findings

ESPN discovered that after comparing the New England Patriots's total passing yards to other teams, we found that other teams had more passing yards. This gave us reason to claim that there is no correlation between total passing yards and who wins the super bowl. We also found that teams with high completion rates did not necessarily have the most passing yards. We also found that teams were most likely to pass on first down, or when the distance to first down was considered long. The plot of passing play outcomes shows that most passes where thrown towards the sidelines. 


## Map of Most Wins per State

```{r, echo=FALSE, message = FALSE, warning=FALSE}
ggplot(plot4, aes(x = long, y = lat, group = group
                      , fill = W)) +
  geom_polygon(color = "white") +
  theme_void() +
  coord_fixed(ratio = 1.3) +
  labs(fill = "Wins per Team Location") +
  theme(legend.position="bottom")

Teamstats2

```






## Limitations

Although each NFL team in a season plays 16 games, we must take into account that each team varies in the amount of pass plays they call, and the skill level in their receiver core, which will have a major impact in their data. Teams that have a strong receiving core, and are a pass heavy team, may have much better passing stats than teams that lack in skilled receivers and focus on running the ball, despite playing the same amount of games. Furthermore, each game is different; though each game has 4, 15 minute quarters, the clock runs differently per game. A close, highly contested game can force teams to call more timeouts, find ways to get out of bounds to stop the clock, or may even go into overtime; all result in more passing plays to try and slow down the clock. A blowout may result in more running plays to keep the game clock running and to keep the game moving, so it ends relatively quicker. Other lurking variables include strength of schedule, injuries, and coaching tendencies. A more difficult strength of schedule may result in less passing yards and passing attempts completed, as the stronger opposing defenses can disrupt the flow of an offense. A coach that relies heavily on running plays and designs his offense around running the ball will certainly decrease the amount of pass attempts completed; this does not mean that the team is worse than a team with more passing yards. For example,  the Chicago Bears only had 3699 passing yards, whereas their rival, the Green Bay Packers, had 4602 yards. The Chicago Bears had an overall record of 12-4 (W-L-D), and the Green Bay Packers had an overall record of 6-9-1 (W-L-D), in 2018. Injuries may also have an impact on a team that focuses on passing the ball. If either the quarterback or a strong receiver gets injured, it may have an impact on the team's passing attempts. 


## Images

![Odell Beckham Jr (WR)](https://ftw.usatoday.com/wp-content/uploads/sites/90/2014/11/ap_aptopix_cowboys_giants_football_68976850.jpg)

![Michael Thomas (WR)](https://static.clubs.nfl.com/image/private/t_editorial_landscape_12_desktop/saints/t0g9bfyocxayqta7jhpn)






